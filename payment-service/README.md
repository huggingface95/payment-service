# Payment Service

Это репозиторий для сервиса платежей.

### Задание на реализацию:
Сделать сервис для интеграции с внешними платежными провайдерами.
Назовем его **payment-service**
Платежных провайдеров будет множество и у каждого свое API и соответственно своя реализация.

Должен быть единый интерфейс для всех провайдеров с реализацией следующих методов:

* `auth()` - авторизация у провайдера
* `iban()`  - отправка запроса на генерацию IBAN
* `payin()` - отправка запроса на получение платежа
* `payout()` - отправка запроса на выплату
* `status()` - запрос состояния транзакции
* `postback()` - прием постбеков от провайдера с информацией о транзакции или генерируемом IBAN

Реализовать обработчики очередей для генерации IBAN, payin, payout.

Основной API на PHP будет помещать в очередь задания, которые данный сервис должен будет обрабатывать
и выполнять соответствующие действия. После чего вносить изменения в базе данных на основании полученных результатов.

Для реализации используем фреймворк fiber который использует быструю реализацию http fasthttp.

### Структура проекта

Проект имеет следующую структуру файлов:
```
payment-service/
├── api/
│ ├── api_service.go    # Логика API-сервиса
│ ├── handlers.go       # Обработчики запросов API
│ ├── router.go         # Конфигурация роутера
│ └── types.go          # Типы данных API
├── app/
│ └── app_service.go    # Логика приложения или бизнес-логика сервиса платежей
├── bin/
│ ├── migrate               # Инструмент для миграции базы данных
│ └── wait-for-postgres.sh  # Скрипт ожидания доступности PostgreSQL
├── db/
│ ├── migrations/
│ │ ├── 0001_${migration_name}.down.sql    # Файл миграции отката для базы данных
│ │ └── 0001_${migration_name}.up.sql      # Файл миграции развёртки для базы данных
│ ├── db.go         # Логика сервиса базы данных
│ ├── db_service.go # Сервис базы данных
│ ├── enums.go      # Определения перечисляемых значений
│ └── types.go      # Типы данных базы данных
├── providers/
│ ├── ${provider_name}/
│ │ ├── ${provider_name}.go     # Логика провайдера платежей
│ │ ├── models.go               # Модели провайдера платежей
│ │ └── submodels.go            # Подмодели провайдера платежей
│ ├── provider_service.go       # Логика сервиса для работы с провайдерами платежей
│ └── providers.go              # Общая логика провайдеров платежей
├── queue/
│ ├── consumer.go       # Логика потребителя очереди сообщений
│ ├── handlers.go       # Обработчики сообщений очереди
│ ├── producer.go       # Логика производителя очереди сообщений
│ ├── queue_service.go  # Сервис очереди сообщений
│ ├── redis_queue.go    # Реализация очереди сообщений на основе Redis
│ └── types.go          # Типы данных очереди сообщений
├── utils/
│ ├── fasthttp_wrapper.go   # Обертка FastHTTP для обработки HTTP-запросов
│ └── package_name.go       # Информация о имени пакета
├── .gitignore          # Список файлов и директорий, игнорируемых Git
├── config.local.yaml   # Локальный файл конфигурации для разработки
├── config.yaml         # Основной файл конфигурации приложения
├── go.mod              # Файл управления модулями Go
├── go.sum              # Файл с контрольной суммой модулей Go
├── main.go             # Точка входа в приложение
├── Makefile            # Правила сборки и запуска приложения
└── README.md           # Файл README с информацией о проекте и инструкциями
```
## Описание пакетов проекта

Сервис платежей отвечает за обработку операций, связанных с платежами. Он состоит из следующих пакетов:

- `api`: Содержит файлы, связанные с API-сервисом, включая логику API-сервиса, обработчики запросов, конфигурацию роутера и типы данных, используемые в API.

- `app`: Содержит файлы, связанные с приложением или бизнес-логикой сервиса платежей.

- `db`: Содержит файлы, связанные с базой данных, включая файлы миграции базы данных, логику сервиса базы данных, определения перечислений и типы данных, используемые в базе данных.

- `providers`: Содержит файлы, связанные с провайдерами платежей. Каждый провайдер платежей имеет собственную директорию с провайдер-специфичной логикой, моделями и подмоделями. Файл `provider_service.go` содержит логику сервиса для работы с провайдерами платежей.

- `queue`: Содержит файлы, связанные с очередями сообщений, включая логику потребителя, обработчики сообщений, логику производителя, логику сервиса очереди, реализацию очереди на основе Redis и типы данных, используемые в очередях сообщений.

- `utils`: Содержит вспомогательные файлы и функции-помощники, такие как обертка FastHTTP для удобной обработки HTTP-запросов и файл с информацией о имени пакета и версии.